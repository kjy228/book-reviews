# Servlet

??????????? ?????? ????????? ??????? ???? ????????? ????

## Annotation ????
### @ServletComponentScan
[????]https://www.baeldung.com/spring-servletcomponentscan

@ServletComponentScan?? ??? configuration???? ????? ?? ???? ?? ?????? ????? ???????????????????. ?????? ?????????? @WebServlet, @WebFilter, @WebListner ?? ???????? ??? ?????? ???????????? ??????? ??????????? ???¥ï? ?????????? @ServletComponentScam?? ??????.
```java
package hello.servlet;

import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;
import org.springframework.boot.web.servlet.ServletComponentScan;

@ServletComponentScan // ?????? ??? ???
@SpringBootApplication
public class ServletApplication {

	public static void main(String[] args) {
		SpringApplication.run(ServletApplication.class, args);
	}

}
```

??????????? `@ServletComponentScan` ?? ?????? application.class ?????? ????????? ??? ????? ?? ???. 

HTTP ????? ???? WAS?? request, response ????? ????? ?????????? ???????.

```java
@WebServlet(name = "helloServlet", urlPatterns = "/hello")
public class HelloServlet extends HttpServlet {

    @Override
    protected void service(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
        System.out.println("HelloServlet.service");
        System.out.println("request = " + request);
        System.out.println("response = " + response);

        String username = request.getParameter("username");
        System.out.println("username = " + username);

        response.setContentType("text/plane");
        response.setCharacterEncoding("utf-8");
        //??? ??? ?????? response ????? ???? ?????? ?? ???.
        response.getWriter().write("hello" + username);

    }
}
```

`@WebServlet`?? ?????? HTTP????? ???? ???¥å? URL?? ????? ?????? ???????? ` protected void service(HttpServletRequest request, HttpServletResponse response)` ????? ??????? ??????. 

## Servlet container ???? ???

<img width="659" alt="image" src="https://user-images.githubusercontent.com/43670838/209827848-9a6f703f-3e77-41bf-ac95-ef192a685fd4.png">

??????????? ?????? application?? ??????? ????????????? ?????? ???????? ??????. 
?? ??, ?????? WAS?? ???? request?? ?????? WAS?? ??????? request, response ????? ??????? url?????? servlet?? ??????? response?? value?? ??????? ?????? ???????. 


## HttpServletRequest
HTTP??? ????? ????? ??????? ????? ?? ????? ?????? ???? HTTP??? ??????? ??????. ?? ????? HttpServletRequest????? ???? ???????. 

` ??? ????? `????? ???????. 
HTTP ?????????? ???? ?????? ??????????? HttpServletRequest????? ???????¥å? ????? request.setAttribute, request.getAttribute?? ?????? ???? ???? ??? ?? ?? ???. 



## JSP
servlet?? ?????? ??? ??? ?????? ???? ?????? html?? ?????? ??? ?????? ????? ????????. ?? ??????©§? html ?¡¾?? ?????? ????? ????? ????? ???? ??? ????????? ?? ??? ???? ?? ??????? ?????? ????? ?????? ???????? ?????? ???????? ???. ???? ??? ???????? ?????????? jsp ?? ??? ???.
![image](https://user-images.githubusercontent.com/43670838/212692640-0c2683f3-9727-4198-95aa-b0ea2308a5d8.png)

```
build.gradle ?????? ????
implementation 'org.apache.tomcat.embed:tomcat-embed-jasper'
implementation 'jakarta.servlet.jsp.jstl:jakarta.servlet.jsp.jstl-api'
```

###  JSP ????
```jsp
<!--> html ?¡¾? ???? ??? ??? ??? </-->
<%@ page contentType="text/html;charset=UTF-8" language="java" %>

<!-->java ??? import </-->
<%@ page import="hello.servlet.domain.member.Member" %>
<%@ page import="hello.servlet.domain.member.MemberRepository" %>

<!-->java ??? </-->

<%
    //request, response ??? ????
    MemberRepository memberRepository = MemberRepository.getInstance();

    System.out.println("MemberSaveServlet.service");
    String username = request.getParameter("username");
    int age = Integer.parseInt(request.getParameter("age"));
%>

```
jsp?? java ??? ?????? ??????? servlet???? ?????? HttpServlet??  request, response?? ????? ?? ???.


?????? jsp?? ????????. ??? ???? java???, ??????? ?????? ???????? ?? ????? ??? ??? JSP?? ?????????. jsp?? ??? ???? ????????? ???????? ???????? ?? ?????? ??? ?????? ¨¨?? ?? ???. ????? ?????? ?????? ????? ?????? ?????? ?????? ??? ???????? ??????, JSP ?? ?????? ?¡Æ? HTML?? view?? ????? ??? ????????? `MVC` ?????? ???????.

## MVC ????
` ?????? ?????? ?????` UI ??? ??????? ??? ???? ?????? ??????? ???? ???? ????? ????? ??????? ???????? ??¥ê? ?????? ???? ?????. ????? ?????? ?????? ??????? ??? ?¥ê??? ????? ???? ??????¡Æ??? ??????????? ???? ???. 
` ??? ??` JSP ???? ?? ???©ª??? ????? ?????? ???? ????? ?????? ?????? ?? ?¥ê??? ?????? ?????¡Æ??? ???? ????????.

`Controller` HTTP ????? ???? ??????? ??????? ?????? ???? ????. ?ãá ?????? ??? ??????? ???? ??? ??¢¥?. 
`Model`: ?ãá ????? ?????¬Ú? ???¬Õ?. ?? ????? ??????? ??? ??? ???? ????????? ???¬á? ??? ?????? ???????. 
`View`: ??? ?????? ??????? ?????? ????? ????? ??? ???????.

```java
@WebServlet(name = "mvcMemberFormServlet", urlPatterns = "/servlet-mvc/members/new-form")
public class MvcMemberFormFServlet extends HttpServlet {
    @Override
    protected void service(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
        String viewPath = "/WEB-INF/views/new-form.jsp";
        RequestDispatcher dispatcher = request.getRequestDispatcher(viewPath);
        dispatcher.forward(request,response);
    }
}
```
`dispatcher.forward()` :  ??? ????????? jsp?? ?????? ??? ?????? ???????¥ï??? ??????? ??????. 
`/WEB-INF`: ?? ??¥î?? JSP?? ?????? ??¥ï??? ????  JSP ????? ?? ????. 

`redirect vs forward`
???????????? ???? ????????? ????? ???????, ????????? redirect??¥ç? ???????. ???? ???? ?????? ?? ??? url ??¥å? ???? ?????????. ??? ??????? ???? ???¥ï??? ????? ?????? ?????? ??? ???????? ?????.

## MVC ???
????¥ç??? ????? ???? ??????? ???? ??? ????. 

`?????? ???` 
View?? ?????? ??? ????????. ?????? ???????? ?????? ??? ????? ??? ???? ?????????. 
```java
        RequestDispatcher dispatcher = request.getRequestDispatcher(viewPath);
        dispatcher.forward(request,response);
```

`viewPath ???`
```java
    String viewPath = "/WEB-INF/views/members.jsp";
```
viewPath ???? jsp?? ???? thymeleaf???? ??? ??? ???????? ??? ??? ?? ??????????. 

????? ?????? ?????? ?????????? ???????? ?????? ??? ?¥ê??? ???? ?? ???? ?????? ?????. ????? ???? ????? ?????? ?????? ?? ?? ??????, ????????? ??? ????? ??? ?????? ??? ????? ??????? ?????? ?????????. ???? ?????¡Æ? ????? ??????. 



## Adapter Pattern
- ???? ??? ??????????? ????, ???? ?????? ?????? ????? ?????? ??????????? ?????? ??????????? ????? ??????? ??????. 
???? ???? ?? ??????? ??? ???? ????????? ???? ?????? ????? ?? ???? ??? ???? ?????? ???????. 
- ?????? ????? ??? ????‚ö????? ?????? ?? ?????? ???????. ???? ?????? ??? ??????????? ???? ??? ??????? ???? ???¥á?????? ?????? ?? ????? ???????.

## DispatcherServlet ???°X??
?????? MVC?? ??????????? ???????? ??????????. 
?????? MVC ???????? ??? DispatcherSErvlet???. 
?? DispatcherServlet?? ??? MVC?? ??????. 

?????? ????? dispatcherServlet?? ?????????? ??????? ?????? ?????`urlPatters="/"` ?? ????? ???????. 

*?????*
- ???????? ????? `HttpServlet` ?? ??????? service() ?? ?????. 
- ?????? MVC?? dispatcherSErvlet?? ?¥è??? FrameworkServlet???? service()?? ????????? ??¥î???. 
- service())?? ???????? `DispatcherServlet.doDispatch() ?? ?????. 

*???? ????*
1. ??? ??? : ??? ?????? ???? ??? URL?? ???¥å? ????? ??????. 
2. ??? ????? ??? : ????? ?????? ?? ??? ??? ?????? ???.
3. ??? ????? ???? : ??? ?????? ???????.
4. ??? ???? : ??? ?????? ???? ????? ???????. 
5. Model And View ??? : ??? ?????? ????? ?????? ?????? ModelandView?? ?????? ??????. 
6. viewResolver ??? : ???????? ??? ???????. 
- jsp?? `InternalResourceViewReslover` ?? ??? ????? ?????. 
7. View ??? : ???????? ???? ????????? ???? ??????? ???? ?????? ?????? ?????? ?? ????? ??????. 
8. ?? ?????? : ?? ????? ?? ?????? ???.
![image](https://user-images.githubusercontent.com/43670838/221402899-67df3345-5cbc-4263-b17f-723d5644dca8.png)


## @Controller ?????? spring Controller


```java
package hello.servlet.web.springmvc.old;

import jakarta.servlet.http.HttpServletRequest;
import jakarta.servlet.http.HttpServletResponse;
import org.springframework.stereotype.Component;
import org.springframework.web.servlet.ModelAndView;
import org.springframework.web.servlet.mvc.Controller;

@Component("/springmvc/old-controller")
public class OldController implements Controller {
    @Override
    public ModelAndView handleRequest(HttpServletRequest request, HttpServletResponse response) throws Exception {
        return null;
    }
}
```
Controller implements??? `web.springmvc.old` ????? ???????? controller?? ?????????.
?? ?? `@Component` ?? bean ????? url?? ?????????.


### ??????????? ??????? ?????? ??? ????? ??? ?????
**HandlerMapping**
```
0 = RequestMappingHandlerMapping : ???????? ????? ???????? @RequestMapping???? ???
1 = BeanNameUrlHandlerMapping : ?????? ???? ??????? ????? ??¢¥?.
```

**HandelrAdapter**
```
0 = RequestMappingHandlerAdapter : ???????? ????? ???????? @RequestMapping???? ???
1 = HttpRequestHandlerAdapter : HttpRequestHandler ???
2 = SimpleControllerHandlerAdapter : Controller ?????????(????????x, ????? ???)???
```
??? ????, ??? ????? ??? ??????? ??? ???? ?????? `????????` ?? ??? ????.

springboot?? ??? ??????????? ???? controller?? ???? ???????? ?????? ???????
1. ??? ???????? ????? ??????. ?? ??? ?? ??????? ????? ???? ??? ?????? ??? ???? ?? ??????? ????? ?????? `BeanNmeUrlHandlerMapping`?? ???? ??????? ????? `OldController`?? ??????. 
2. ??? ????? ??? : `HandlerAdapter`?? `supports()` ?? ??????? ?????? SimpleCOntrollerHandlerAdapter?? ???? ???????. 
3. ??? ????? ????
?????? ???????? ????? SimpleControllerHandlerAdapter?? ??????? ??? ?????? ??? ??????. 


```java
@Component("/springmvc/request-handler")
public class MyHttpRequestHandler implements HttpRequestHandler {
    @Override
    public void handleRequest(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
        System.out.println("MyHttpRequestHandler.handlerRequest");
    }
}
```
???? ???? application ?????? localhost:8080/springmvc/request-handler ????? spring???¥ï??? ???? ??????

`??? ???????? ??? ???`
1. HandlerMapping?? ?????????? ??????? ????? ??¢¥?. 
2. ?? ??? ?? ??????? ????? ???? ??? ?????? ??? ???? ?? ??????? ????? ?????? `BeanNameUrlHandlerMapping` ?? ???? ??????? ????? `MyHttpRequestHandler` ?? ??????. 
`??? ????? ???`
1. `HandlerAdapter`?? `supports()?? ??????? ??????. 
2. `HttpRequestHandlerAdapter`?? `HttpRequestHandler ??????????? ???????? ????? ???. 

`??? ????? ????`
1.?????? ???????? ????? `HttpRequesthandlerAdapter?? ??????? ??? ?????? ??? ??????. 
2.`HttpRequestHandlerAdapter?? ????? `MyHttpRequestHandler`?? ???¥ï??? ??????? ?????? ??????.


## ViewResolver

```java
@Component("/springmvc/old-controller")
public class OldController implements Controller {
    @Override
    public ModelAndView handleRequest(HttpServletRequest request, HttpServletResponse response) throws Exception {
        System.out.println("OldController.handlerRequest");

        return new ModelAndView("new-form");
    }
}
```

```
//appication.properties
spring.mvc.view.prefix=/WEB-INF/views/
spring.mvc.view.suffix=.jsp
```
prefix?? suffix?? ??????  ModelAndView???? jsp?? ?????? ?? ???. ?? ?????? ?????? ??????? ?????? ??????? ????????? ???????.
```java
@Bean
ViewResolver internalResourceViewResolver(){
    return enw InternalResourceViewResolver("/WEB-INF/views/", ".jsp");
}
```

# SpringMVC

`@Contorller`
- ???????? ??????? ?????? ??????.(???¥ï? `@Component?? ??? ??????? ????? ????? ??)
- ??????MVC???? ???????? ??? ???????? ?¥í????.
- `ReuqestMappingHandlerMapping` ?? ?????? ?? ????? `@RequestMapping`, `@Controller` ?? ????? ?????? ?????? ??? ?????????? ?¥í????.

## RequestMapping ?¢®
```java
@RequestMapping(value = "/new-form")
    public String newForm() {
        return "new-form";
    }
```
???? api?? postman?? ?????? ????? ?????? Get, Post, delete ??? http Request????? ???????. ???? ????????? ??????? ????? ??? ???? ?????????. 

```java
@RequestMapping(value = "/new-form", method = RequestMethod.GET)
    public String newForm() {
        return "new-form";
    }
```

## @Controller?? @RestController ?? ????

@Controller
- ???????? view ????? ?????????? ??????.
- view?? ????????????? viewResolver?? ????? ???????¡Æ? view?? ??? ?????????.

@Restcontroller
- data??? json???? return?? ?? ????? ???.

---

## Log ???? 
- Log level : trace - debug - info - warn -error
- ??????? : debug???
- ?? ???? : info ??? ( info, warn, error ?????? log ????)

## Log ??¨ö? ???? ????
```java
log.info("info long= {}", name); // ????? ?????
log.info("info long= "+ name); // ????? X
```
?? ?????? `log.info("info long= "+ name)` ?? ?????? ?????? ?????????? ??????? ????? ????(infolong=name)?? ??? ???? ????? ???. ??, ??????? ??????? ?????? ???. 

-----
## QueryParam vs PathVariable ????
@QueryParam
- ?? ?????????? ?????? url ??¥ï? ? ?? ??¢¥?

@PathVariable
```java

```
?????? url ??? `http://localhost:8080/mapping/1` ?? ???? ???¥ä?. ???? ?????? ?????? ?????? heaer?? ??¥è? ???? ??? ?????? ???? ???¥ä?. 
![image](https://user-images.githubusercontent.com/43670838/225639281-e46bbf22-d308-415c-99b4-f7456428b597.png)


## Http Request


### @ResponseBody?? ?????
```java
@Slf4j
@Controller
public class RequestParamController {

    @ResponseBody
    @RequestMapping("/request-param-v2")
    public String requestParamV2(
            @RequestParam("username") String username,
            @RequestParam("age") Integer age) {

        log.info("username={}, age={} ", username, age);
        return "ok";
    }
}

```
controller?? ???? ???? ???? ?????? ??????? @Controller ?????????? ?????? ??????
"ok"?? ??????? viewname?? ??????? ???. 
?????? `@ResponseBody`?? ?????? String???? ?????? ?? ???.

### @RequestParam

<b>?¢®</b>
- ???????? ?????? `@RequestParam("username") String username` -> `@RequestParam String username` ???? ???? ?? ?? ???. 
- ???????? ?????(String, int?? )?? ?????? `@RequestParam String username` -> `String username`  ???? ?????? ?? ???.
- primitive type ?? null ??? ???. `@RequestParam(required=false) int age`?? ????????? int?? ???? Integer?? ?????? null ???? ???? ?? ???. ???? `defaultValue` ????? ?????? ???.


## @RequestBody
```java
package hello.springmvc.basic.request;

import jakarta.servlet.ServletInputStream;
import jakarta.servlet.http.HttpServletRequest;
import jakarta.servlet.http.HttpServletResponse;
import lombok.extern.slf4j.Slf4j;
import org.springframework.stereotype.Controller;
import org.springframework.util.StreamUtils;
import org.springframework.web.bind.annotation.PostMapping;

import java.io.IOException;
import java.nio.charset.StandardCharsets;

@Slf4j
@Controller
public class RequestBodystringController {
    @PostMapping("/request-body-string-v1")
    public void requestBodyString(HttpServletRequest request, HttpServletResponse response)throws IOException{
        ServletInputStream inputStream = request.getInputStream();
        StreamUtils.copyToString(inputStream, StandardCharsets.UTF_8);
    }
}

```

Stream?? ??? byte ?????????? ??????? ?????? ??????? ?? `??`???? ??????? ?????????.


## HttpEntity
Http heaer , body?????? ??????? ????? ?? ???. 
????? ??? ?????? ???? ???
??? ??????? ?????? ???? ???? ????(@RequestParam, @ModelAttribute)
- httpentity?? ???ãá???? ??“N?????. 
- ????? ??? ???? ???? ??? ?? ??????? ???? ?????????? `view ????? ???`

HttpEntity?? ?????? ???? ????? ???? ????? ???????. 
`ReqeustEntity` : HttpMethod, url ???? ???, ??????? ???
`ResponseEntity`: http??????? ???? ????, ???ãá ??? ?? (`return new ResponseEntity<String>("Hello workd", responseHeaders, HttpStatus.CREATED))`


## @RequestBody
http ????????? ??????? ????? ?? ???. ????????? ??????? `HttpEntity, @RequestHeader` ?? ????????. 

@RequestBody ?? ??????? `@ModelAttribute` ?? ???. ???? ??????? ????. 
- `@RequestParam`  :String, int, Integer???? ??? ??? ??? 
- `@ModelAttribute` : ????? ??? (argument resolver?? ???????? ??? ??)
???? @RequestBody?? ??????? @ModelAttribute ?? ?????? http ????? ??? ???? ??? ??????? ?????? ???.


## Http ????

???? ??????? ????? ???
- ???? ????? : ???? ???? html, css, js?? ????????? ???? ????? ???
- ?? ???©ª? ??? : ???? Html ??????? ?????©ª? ???
- Http ????? ??? : http api?? ??????? ??? ??????? ?????????? ?????? Json???????? http message body?? ??????? ??? ????

### ???? ????? 
?????? ????? `/static, /public , /resource, /META_INF/resource ` ?????? ??? ???? ??????? ???????.

### ?? ???©ª?
?????©ª??? ????? html?? ???? ??? ?? ?????? ????? ???????. 
????????? html?? ???????? ??????? ?”³?? ????????? ?????©ª??? ???? ?? ??¡Æ???? ???? ???????. 
?????? ????? `src/main/resources/templates` ??¥è? ?? ?? ???©ª? ??¥ç? ???????.

### Thymeleaf ?????? ??? ????
```gradle
implementation("org.springframework.boot:spring-boot-starter-thymeleaf")
```
?????? ????? ??????? `ThymeleafViewResolver` ?? ????? ?????? ??????? ??????. ????? ???? ?????? ???????? ?????? ?????? ???????? ?????????. 

```properties
spring.thymeleaf.prefix=classpath:/templates/
spring.thymeleaf.suffix=.html
```

## Http message Converter

`@ResponseBody` ???
- http body?? ???? ?????? ???? ???
- viewResorver ???? HttpMessageConverter?? ????
- ?? ??????? : StringHttpMessageConverter
- ?? ??? ??? : MappingJackson2HttpMessageConverter
- byte ??? ??? ??? ???? httpMessageConverter?? ?????? ?????????

?????? ??? ????????? httpAccept ????? ?????? ?????? ??? ??? ???? ???? ??????? httpMessageConverter?? ??????.

<b>?????? MVC?? ?????? ??? Http ????? ??????? ???????. </b>
- Http ??? : `@RequestBody, HttpEntity(RequestEntity)`
- Http ???? : `@ResponseBody, HttpEntity(ResponseEntity)`
controller?? api ?? ????????? ????? ??????? ????? @RequestBody, httpEntity?? ?????? ??? ????? httpbody?? ????? ?????? ?? ????? ?????????? api?? ???????.



## ??? ???? ??? ????? ????
![image](https://user-images.githubusercontent.com/43670838/232226071-448206f0-b350-4872-b7b4-6f8560ef8ed8.png)

### ArguemtnResolver
???????? ??? ???????? ?????? `RequestMappingHandlerAdapter ` ?? ??? `ArgumentResolver?? ?????? ???????? ??????? ????? ???????? ???? ???????. ????? ?? ???????? ???? ??? ????? ???????? ?????? ???? ??????.


## MessageÃ³¸®
ÇöÀç ½ºÇÁ¸µºÎÆ®´Â ¸Þ¼¼Â¡ Ã³¸®¸¦ ÀÚµ¿À¸·Î ÇØÁØ´Ù. ¼öµ¿À¸·Î ¸Þ¼¼Â¡Ã³¸® ºóÀ» µî·ÏÇÏ´Â ¹æ¹ýÀº ¾Æ·¡ ÄÚµå¸¦ ÂüÁ¶ÇÏ¸éµÈ´Ù. 
```java
/**
	 * ¸Þ¼¼Áö °ü¸® Bean
	 * ÇöÀç´Â spring¿¡¼­ ÀÚµ¿À¸·Î µî·ÏÇÑ´Ù.
	 */
	@Bean
	public MessageSource messageSource(){
		ResourceBundleMessageSource messageSource = new ResourceBundleMessageSource();
		messageSource.setBasenames("messages", "errors");
		messageSource.setDefaultEncoding("utf-8");
		return messageSource;
	}
```

`basenames`: ¼³Á¤ ÆÄÀÏÀÇ ÀÌ¸§À» ÁöÁ¤ÇÑ´Ù. message·Î ÁöÁ¤ÇÏ¸é message.properties ÆÄÀÏÀ» ÀÐ¾î¼­ »ç¿ëÇÑ´Ù. 
ÆÄÀÏ À§Ä¡´Â `/resources/messgaes.properties` ¿¡ µÎ¸é µÈ´Ù. 

½ºÇÁ¸µºÎÆ®¿¡¼­ ¸Þ¼¼Áö ¼Ò½º¸¦ ¼³Á¤ÇÏ±âÀ§ÇØ¼­ ¼öµ¿À¸·Î ºóÀ» µî·ÏÇÏÁö¾Ê°í `application.properties ` ¿¡ ¾Æ·¡ ¼Ò½º¸¦ ¼³Á¤ ÇÒ ¼ö ÀÖµû. 
```
spring.messages.basename = messages,config.i18n.messages
```
½ºÇÁ¸µ ºÎÆ® ¸Þ¼¼Áö ¼Ò½º±âº»°ªÀº basename = messages ÀÌ´Ù. 
