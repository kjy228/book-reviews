# Day1
## 천만 사용자를 위한 카카오의 aws native 글로벌 채팅 서비스

### 글로벌 채팅 서비스 요구사항 구축 젼략
- 글로벌 서비스 출시, 중요한 것에 집중, 빠르고 바른 의사결정
- 글로벌 인프라 스트럭쳐

<b>AWS Lambda</b>
이벤트 소스를 비동기적으로 function을 주입하면 처리할 수 있음
격리된 마이크로 vm에서 안전하게 실행됨
작업을 수행한다음에 폐기 처분되므로 자원 삭제에 대한 부담 업ㅅ음

람다에서 어떤 정보르 넣겟다하면 index만 주입하면된다. ( 복잡도 : O(1))
aws에는 프로토타입 팀이 있어서 최종 사용자 경험과 유사한 직관적인 제품 구현을 같이할 수 있다.

api gateway, dynamoDb, lambda로 전환 후 세션, 로스터, api, rdbms 관리포인트 감소
현재는 메시지보관, 답글 달기, 공지, 좋아요 달기등과 같은 주제가 화두됨

구현 전략
안티패턴
- 이전의 설계경험을 바탕으로 대규모 시슽메과 맞지 않는 패턴 사용 자제

솔루션스 아키텍트 협업
- 프로제긑 초기부터 aw팀과 협업하여 서비스에 최적화된 검토
기술과 기획의 타협
- 엔지니어링 비용과 고객 만족 사이의 적절한 가성비

<b>글로벌 지원 방법</b>
대부분 트래픽은 리전안에서 발생하지만 리전을 넘어서 채팅하는 경우도 발생
이에따라 아키텍쳐 개선 하여 리전을 넘는 통신과 글로벌 데이터베이스 동기화 지원
다른 리전정보는 lambda사용
리전간 동기화 : dynamoDb global table 사용 (의존은 최소화하기)
중국과 동기화하기 위해서 프록시 역할 : amazmon cloudfront, GAAP



## 삼성전자/쿠팡의 대규모 트래픽처리를 위한 클라우드 네이티브 데이터베이스 활용
### 삼전 사례
차세대 메시지 플랫폼 채팅 플러스 출시 : `NNI 란? 찾아보기`
삼성 RCS 서비스를 on-premise에서 aws 로 전환하면서 Lift ahn shift전환 
-> 비용 절감을 위해 데이터 의존성을 줄여야하며 마이크로 서비스 아키텍쳐로 사용

정합성 품질과 성능품질은 tradeoff 되는 경우가 많다ㅏ. 
챗봇은 읽기가 많고 쓰기가 현저히 작은데 요구사항을 마족하기위해서 aurora, elasticache 를 사용하여 성능은 높혔지만 정합성은 줄얻르 수 밖에 없었다. 
정합성을 해결하기위해 key event 방식을 사용하여 정합석 파괴시간을 줄임

다이나모 db - strong consistency read 사용
aurora : consistency lock 사용

### 쿠팡Db엔지니어가 클라우드 사용하는 방법
하나의 노드가 수용할 수 있는 트래픽으 ㄴ한정되어있음 -> 특정 서비스에 트래픽이 비대하게 증가하는 현상 발생
이런 트래픽 증가를 해결하기 위해 서비스 내에서 서비스스 더 세분화 하여 논리적으로 분리하거나 db sharding해서 사용
데이터수정(DML), 테이블 구조변경(DDL), 접근권한요청(ACL) 이 xxx% 증가하여 이런것을 줄이기위한 해답으로 스마트 지원서비스 사용

스마트 지원서비스 사용전에는 업무요청서 - 롤백데이터 생성 - dml수행 - 변경데이터 확인- 업무 요청서 완료처리의 프로세스가 들었지만 도입 후 책임자가 데이터 변경 승인만 하면 된다.
서비스 안정화 관리로 
세션 관리
- 트랜잭션 모니터링
오래수행되는 쿼리 모니터링
서버의 일정 성능을 보장
데이터사이즈 관리


## AWS EC2 인스턴스 

<b>Nitro 시스템</b>
Nitro 시스템 위에 서버( Hypervisor, instance os, application )이 올라간다
낮은 대기시간과 높은 보안을 제공한다. 이 안에는 Security, storage, network 가 포함된다.

Nitro card : vpc네트워킹()
Nitro 보안칩 : 가상화 및 보안 기능이 전용 하드웨어 소프트웨어에 오프로드되어 공격 표면이 최소화된 안전한 플랫폼 지원
하이퍼바이저 : 메모리, cpu할당관리

### 삼전 사례
비용절감 필요, arm기반 프로세서 약진(apple m1, aws graviton), 저전력 cpu 등의 이유로 ec2도입
ec2의 새로운 인스턴스가 나왔따면 무조건 써라 
application용 ec2를 x86에서 arm 프로세서로 바꾸기위해선 어떻게 해야 될까?
1. 호환성 체크
2. 토커 멀티빌드 : 애플리케이션, 컨테이너, 믈티플랫폼 이미지 빌드
    docker buildx를 사용해서 arm기반, x86기반 이미지를 한번의 빌드로 얻을 수 있다.
    
3. 트러불슈팅으로 pod 이슈 해결 
    스테이징에서 나오지 않는 문제가 발생했는데 deploy 밑에있는 pod중에서 트래픽이 많은 pod에서 재시작하는 이슈가 발생
    -> 자바 버전을 최신으로 올릴수록 발생 빈도는 줄어든다. openjdk 버전 up하면 마이너 버전은 지원이 안되서 alpine을 사용함
    -> jdk버그 fix리스트를 보ㅕㄴ arm64 관련 내역이 많이 나온다.
    -> 모니터링 툴로 datadog을 사용하는데 pod가 재시작되고 정상적으로 서비스 되어도 트래픽이 화인되지않음. 
    -> 따라서 모든 디펜던시를 최신으로 업데이트 해야된다.
-------


## 스마트한 클라우드
2022년에 101zb의 데이터가 생성됨
폭발적인 데이터증가에따라 다양한 유혀으이 데이터, 확장성의 한계, 높아지는 비용 이라는 과제가있고
데이터보호와 연속성 보장이 복잡해짐에따라 위험이 증가된다. 데이터 수집 단계에서 가치창출의 단계로 이동하며 혁신을 주도할 수 있는 기회가 주어진다.
이런것들ㅇㄹ위해 aws스토리스 서비스들이 있다. 

### 오브젝트(S3)
- 스토리지 분석
- 스토리지 클래스 
    엑세스 규칙을 알수 있따면 s3 숨여주기관리를 사용, 패턴을 알 수 없다면 s3 인텔리저트 티어링 적용 
    - S3 인텔리전트 티어링 : frequent, infrequent, archive instant 티어로 구성되어있다.
    - S3 storage lens : 바르게 증가하는 버킷, 저렴한 s3 스토리지 클래스 상요하고있는지 불완전한 멀티파트 업로드가 있는지 확인할 수 있음
- 데이터 숨여주기
- 인텔리전트 티어링


### 블록(EBS)
ㅇ백업을위한 스냅샷과 스냅샷의 수명주기를 관리
aws compute optimizer 를 사용 하여 볼륨의 최적화를 할수 있따. 
io2 : 프로비저닝된 IOPS설정 최적화
gp3 : IOPS와 처리량을 별도로 프로비저닝하여 적절한 크기의 gp3볼륨, 볼륨에대한 IOPS및 처리

### Data lifecycle manager 

### 비용 최적화
- 클라우드 비요을 분석하고 개선점담할수 팀 구성
- 워크로드 분석하여 가장 적합한 스토리지 서비스 선태학여 사용(접근패턴, 데이터 유ㅇ형, 내구성, 성능)
- 사용된 스토리지 서비스의 비용 최적화 기술들을 활용
- 모니터링, 분석, 개선 작업 수행

## Finle storage 비용 최적화
광험위한 스펙트럼 으로 
세가지 유형에 따른 파일 스토리지 솔루션이있다
클라우드 네이티브 앱과 우커플로 : efs
네트워크 연결 스토리지 :FSx
무자헨 캄퓨팅 확장 : FSx

### EFS
처클라우드에서 사용할 수 있는 공유 스토리지
서버리스, 완전 탈력성
- 모든 클라우드 컴퓨팅 리소스(Ec2, 컨테이너 및 서버리스)에서 액세스 가능
- AI/ML ㅌSaas앱 등에서 사용가능

`수명주기 관리 `
IA스토리지 클래스로 데이터르 ㄹ이동할 수 있다. 
스탠다드 클래스(MAZ, 1Z) : 범용파일 스토리지 클래스 
인프리퀀트 액세스 클리스(IA) : 자주 액세스하지 않는 파일을 위한 클래스
비용측면으로 사용하지 않는 파일은 IA 클래스로 옮기는것이 좋다 (1/10으로 비용절감)
### FSx
Fxs for NetApp ONTAP
- 클라우드로 마이그레이션하거나 확장하는 가장 쉬운 경로 제공
- ONTAP의 데이터 관리기능, 자동 계층화, 데이터 압축 및 중복제거, 다중 프로토콜 지원
- 엔터프라이즈 IT앱, 콘텐츠 관리, 팀 협업 공유

` ontap 데이터 티어링 `
SSD티어
capacity pool 티어 


------
## AWS 자격증
기초- 어소시에이트 - 프로페셔널 - 전문영역 의 등급이 있다.
aws.training사이트 통해 시험 예약 가능
시험일정 변경은 2번만 가능

자격증 유효기간 3년 
credly를 통해 디지털 뱃지 제공
신분증 2개 필요 (여권)
일지선다 혹은 다지선다
온라인은 화장실에 갈 수 없음, 웹캠에 다른 사람이 찍히는 순간 실격
샘플문항 풀어보기
관련 aws 강의 수강
디지털 시험 준비 워크샵 수강
연습문제 풀기
유로문제도 있음
<b>가장</b>으로 시작하는 키워드 주의 
비용이나 ㄹ시간을 중시한다면 관리형 >파트너 솔루션 >오픈소스>직접 구현 순을 답확률이 높음
- 연습 시험
정답은 알려주지 않고 점수만 확인 가능 
기초/어소시에이트는 20달러 30분 20문항임


